<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Georgia:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jython,python," />





  <link rel="alternate" href="/atom.xml" title="Jingwen's Note" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Sikuli ScriptTo get debug output, if you use the SikuliX apps or otherwise have no chance to set parameters:before starting add an empty file named SikulixDebug.txt in your home folder. This is detect">
<meta name="keywords" content="jython,python">
<meta property="og:type" content="article">
<meta property="og:title" content="SikuliX">
<meta property="og:url" content="http://fatelancer.github.io/2018/06/21/SikuliX/index.html">
<meta property="og:site_name" content="Jingwen&#39;s Note">
<meta property="og:description" content="Sikuli ScriptTo get debug output, if you use the SikuliX apps or otherwise have no chance to set parameters:before starting add an empty file named SikulixDebug.txt in your home folder. This is detect">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://sikulix-2014.readthedocs.io/en/latest/_images/pycharmDefaultInterpreter.png">
<meta property="og:image" content="http://sikulix-2014.readthedocs.io/en/latest/_images/pycharmDefaultConsole.png">
<meta property="og:updated_time" content="2018-06-21T08:42:09.565Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SikuliX">
<meta name="twitter:description" content="Sikuli ScriptTo get debug output, if you use the SikuliX apps or otherwise have no chance to set parameters:before starting add an empty file named SikulixDebug.txt in your home folder. This is detect">
<meta name="twitter:image" content="http://sikulix-2014.readthedocs.io/en/latest/_images/pycharmDefaultInterpreter.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://fatelancer.github.io/2018/06/21/SikuliX/"/>





  <title> SikuliX | Jingwen's Note </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jingwen's Note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Someone will look through your heart.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fatelancer.github.io/2018/06/21/SikuliX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jingwen CHEN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jingwen's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                SikuliX
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-21T15:13:13+08:00">
                2018-06-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a class="cloud-tie-join-count" href="/2018/06/21/SikuliX/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count join-count" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Sikuli-Script"><a href="#Sikuli-Script" class="headerlink" title="Sikuli Script"></a><a href="http://www.sikuli.org/" target="_blank" rel="external">Sikuli Script</a></h1><p>To get debug output, if you use the SikuliX apps or otherwise have no chance to set parameters:<br>before starting add an empty file named SikulixDebug.txt in your home folder.</p>
<p>This is detected and will internally switch to <code>running with -d 3 -c</code> and redirect all debug output to this file.</p>
<p>The debug level can also be set inline in scripts and code<br>… and will be used from this point on until switched off or reset to another value</p>
<ul>
<li><code>Debug.on(3)</code> — switch debugging on with level 3</li>
<li><code>Debug.off()</code>— switch debugging off</li>
</ul>
<a id="more"></a>
<h2 id="general-aspect-of-scripting"><a href="#general-aspect-of-scripting" class="headerlink" title="general aspect of scripting"></a>general aspect of scripting</h2><p>Below is an Example of SikuliX script in Python:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>: <span class="comment"># repeat the body forever</span></div><div class="line">    wait(<span class="string">"image1.png"</span>, <span class="number">10</span>) <span class="comment"># wait max 10 seconds for image1 to get visible, otherwise die</span></div><div class="line">    click(<span class="string">"button1.png"</span>) <span class="comment"># click the button given by image button1</span></div><div class="line">    <span class="keyword">if</span> exists(<span class="string">"image2.png"</span>): <span class="comment"># wait max 3 seconds for image2 to get visible, return True or False</span></div><div class="line">       doSomething() <span class="comment"># in case True execute function doSomething (defined somewhere else)</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">       <span class="keyword">break</span> <span class="comment"># in case False get out of the loop, which ends the workflow</span></div><div class="line">    <span class="comment"># start all over with the line after the while</span></div><div class="line"><span class="comment"># the end of the workflow</span></div></pre></td></tr></table></figure>
<h2 id="Where-and-how-can-a-SikuliX-script-be-stored"><a href="#Where-and-how-can-a-SikuliX-script-be-stored" class="headerlink" title="Where and how can a SikuliX script be stored"></a>Where and how can a SikuliX script be stored</h2><p>A SikuliX script consists of <strong>one file containing the statements of your scripted workflow</strong> and zero to many image files, that you have captured, to support your workflow.</p>
<p>This bunch of related files is meant when we talk about a SikuliX script.</p>
<p>How to run such a script is shown in the next chapter.</p>
<p><strong>The standard storage for a SikuliX script is a folder/directory having the name that you have given to the script</strong>, when saving it from the IDE. It is mandatory, that the contained script file has the same name as the folder, which is guaranteed, when working with the SikuliX IDE. To avoid any problems, <strong>you should never directly access the folder content outside the SikuliX IDE</strong>, except you really know, what you are doing.</p>
<p>The file structure is like below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">myscript.sikuli</div><div class="line">    button1.png</div><div class="line">    image1.png</div><div class="line">    image2.png</div><div class="line">    myscript.py</div></pre></td></tr></table></figure>
<p>There are two other storage variants for SikuliX scripts: zip-file and jar-file, which are intended for distribution of your scripts. Both variants pack the SikuliX script content in one file, which makes distribution easier. Both variants can be run with the means of SikuliX, as long as the target system has a valid SikuliX installation/setup.</p>
<ul>
<li><p>variant zip-file</p>
<p>It can be created in the SikuliX IDE with the file menu entry <code>Export packed source</code> and gets the <code>ending.skl</code> instead of <code>.sikuli</code>. As such it cannot be reopened for editing nor used for import, it can only be run using SikuliX features on systems having a valid SikuliX setup. In fact it is simply a zip-file, which can be brought back to a <code>.sikuli</code> folder using a zip utility. So be aware, that this variant does not really hide your script content.</p>
</li>
<li><p>variant jar-file (only available in 1.1.2+)</p>
<p>It can be created in the SikuliX IDE (file menu entry <code>Export as jar</code>). It can be run using SikuliX features on systems having a valid SikuliX setup. The script source is contained in compiled form (Java byte code) and hence not visible, even if one accesses the jar content. So this variant gives some level of secrecy for your scripted workflow.</p>
<p>There is a sub-variant, containing the scripting and SikuliX feature support additionally to the script content, which makes it runnable even on systems not having a valid SikuliX setup, but only a valid Java installation. Be aware, that such a jar has at least 60 MB though. <a href="https://answers.launchpad.net/sikuli/+faq/2947" target="_blank" rel="external">How to make and use it look here</a>.</p>
</li>
</ul>
<h2 id="How-to-Run-a-SikuliX-script"><a href="#How-to-Run-a-SikuliX-script" class="headerlink" title="How to Run a SikuliX script"></a>How to Run a SikuliX script</h2><p>In the SikuliX IDE a currently open script in the front most editor tab can be run by clicking the run button.</p>
<p>Saved scripts (.sikuli) and exported scripts (<code>.skl</code> and <code>.jar</code>) can be run from command line(<a href="http://sikulix-2014.readthedocs.io/en/latest/faq/010-command-line.html#runningscriptsfromcommandline" target="_blank" rel="external">see</a>) or from within other scripts (<a href="http://sikulix-2014.readthedocs.io/en/latest/scripting.html#runningscripts" target="_blank" rel="external">see</a>).</p>
<h1 id="Using-Python"><a href="#Using-Python" class="headerlink" title="Using Python"></a>Using Python</h1><h2 id="Setup-a-Jython-environment"><a href="#Setup-a-Jython-environment" class="headerlink" title="Setup a Jython environment"></a>Setup a Jython environment</h2><p>Apply the following steps, to get a Jython environment, that is SikuliX aware:</p>
<ul>
<li>download the installer package from Jython Downloads</li>
<li>install (usually by double-clicking the package) using the standard setup into an empty folder</li>
<li>test by running <code>&lt;jython-folder&gt;/bin/jython</code> from a command line, which should open an interactive Jython session, that allows, to run Python statements line by line</li>
<li>make sure, that pip and easy_install are available:<ul>
<li><code>&lt;jython-folder&gt;/bin/pip</code> exists</li>
<li><code>&lt;jython-folder&gt;/bin/easy_install</code> exists</li>
<li>if this is not the case run <code>&lt;jython-folder&gt;/bin/jython -m ensurepip</code> on a command line and check again</li>
<li>if you do not get pip ready, don’t bother: Jython is useable without it. The caveat: any additional packages have to be installed/setup manually.</li>
</ul>
</li>
</ul>
<p>If you succeeded with pip:</p>
<ul>
<li>run <code>&lt;jython-folder&gt;/bin/pip install jip</code> to install the package <code>jip</code>, which allows to add Java libraries easily to your Jython environment</li>
<li>add any needed Python package (must not depend on C-based stuff) using <code>pip, easy-install</code> or manual methods into<code>&lt;jython-folder&gt;/Lib/site-packages</code> and/or use <code>jip</code> for adding Java libraries preferably from Maven Central</li>
</ul>
<h2 id="Access-Python-packages-from-SikuliX-scripts-run-by-SikuliX-GUI-or-command-line"><a href="#Access-Python-packages-from-SikuliX-scripts-run-by-SikuliX-GUI-or-command-line" class="headerlink" title="Access Python packages from SikuliX scripts run by SikuliX (GUI or command line)"></a>Access Python packages from SikuliX scripts run by SikuliX (GUI or command line)</h2><p>The following approaches apply to situations, where you want to use Python modules installed somewhere on your system, without the need to manipulate <code>sys.path</code>, meaning, that when using <code>ìmport moduleXYZ</code> this package is found automatically.</p>
<p>SikuliX uses a central repository (<code>SikulixRepo</code> in the following) for internal stuff (native libraries, downloaded artifacts, resources needed at runtime and similar things). This is a folder in the user’s private space (home folder) <a href="http://sikulix-2014.readthedocs.io/en/latest/basicinfo.html#sikulixappdata" target="_blank" rel="external">look here</a>:</p>
<ul>
<li>Windows: <code>%APPDATA%\Sikulix</code></li>
</ul>
<h3 id="Basic-preparation"><a href="#Basic-preparation" class="headerlink" title="Basic preparation"></a>Basic preparation</h3><p>To <code>SikulixRepo</code> add a folder <code>Lib</code> (if not already there) and inside add a folder <code>site-packages</code></p>
<h3 id="Approach-1"><a href="#Approach-1" class="headerlink" title="Approach 1"></a>Approach 1</h3><p>Since an existing folder <code>SikulixRepo/Lib/site-packages</code> will be recognized and added automatically as the <code>1st entry to sys.path</code>, modules/packages contained in here will be found when imported without any further preparations. This approach can be used, to “overwrite” modules/packages, that otherwise would be found elsewhere on <code>sys.path</code> (e.g. for testing)</p>
<h3 id="Approach-2"><a href="#Approach-2" class="headerlink" title="Approach 2"></a>Approach 2</h3><p>In the folder <code>SikulixRepo/Lib/site-packages</code> have a file <code>sites.txt</code>, that contains absolute paths one per line, that point to other places, where modules packages can be found. These paths will be added automatically at startup to the <code>end of sys.path</code> in the given sequence. With this approach, you might for example add the <code>Lib/site-packages</code> folder of your own Jython installation.</p>
<h2 id="Prepare-and-use-your-own-jar-files-in-the-Jython-environment"><a href="#Prepare-and-use-your-own-jar-files-in-the-Jython-environment" class="headerlink" title="Prepare and use your own jar files in the Jython environment"></a>Prepare and use your own jar files in the Jython environment</h2><p>You might prepare jar files containing Python scripts/modules/packages, Java classes and other stuff like images, that are intended to be used in the scripting context.</p>
<h3 id="possible-use-case"><a href="#possible-use-case" class="headerlink" title="possible use case"></a>possible use case</h3><ul>
<li>you want to pack scripted stuff together with other resources into a container ready to be used by yourself or others via import (which is not supported by the <code>.skl</code> packaging method).</li>
<li>you want to secure your script code against modifications by others, that use your distributed jar.</li>
</ul>
<p>Later (possibly only with version 2) there will be a feature available, to run such script containers directly from command line (<code>java -jar mystuff.jar parameters</code>) or by double clicking.</p>
<h3 id="typical-jar-file-structure"><a href="#typical-jar-file-structure" class="headerlink" title="typical jar file structure"></a>typical jar file structure</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">-- jar rootlevel</div><div class="line">module1.py    <span class="comment"># Python module</span></div><div class="line">module2.py</div><div class="line">- folder1     <span class="comment"># Python package</span></div><div class="line">  __init__.py</div><div class="line">  stuff1.py</div><div class="line">  stuff2.py</div><div class="line">- images      <span class="comment"># image folder</span></div><div class="line">  img1.png</div><div class="line">  img2.png</div><div class="line">- org         <span class="comment"># Java package</span></div><div class="line">  - mystuff</div><div class="line">    class1.<span class="keyword">class</span></div><div class="line">    class1.<span class="keyword">class</span></div></pre></td></tr></table></figure>
<h3 id="how-to-pack-such-a-jar"><a href="#how-to-pack-such-a-jar" class="headerlink" title="how to pack such a jar"></a>how to pack such a jar</h3><p>You might use the Java <code>jar utility</code> (contained in the JDK).</p>
<p>Or use the <strong>SikuliX provided</strong> feature <code>Sikulix.buildJarFromFolder(jarpath, folder)</code>, where <code>jarpath</code> is the absolute path to the jar (the parent folder must exist, the jar is overwritten), that should be created and folder is the absolute path to a folder, containing the stuff to be packed. The content of the folder is copied to the root of the created jar.</p>
<p> Just run <code>Sikulix.buildJarFromFolder(jarpath, folder)</code> in an empty tab in the IDE or in a script, that might do some pre- and/or post processing.</p>
<p>If the folder contains an <code>__init__.py</code> on the first level, the given folder is taken as a Python package and as such copied to the root level of the jar, to preserve the package context:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-- packagefolder</div><div class="line">  __init__.py</div><div class="line">  stuff.py</div><div class="line"></div><div class="line">becomes a jar</div><div class="line">-- jar rootlevel</div><div class="line">- packagefolder</div><div class="line">  __init__.py</div><div class="line">  stuff.py</div></pre></td></tr></table></figure>
<h3 id="how-to-secure-your-script-code-using-the-jar-packaging"><a href="#how-to-secure-your-script-code-using-the-jar-packaging" class="headerlink" title="how to secure your script code using the jar packaging"></a>how to secure your script code using the jar packaging</h3><ul>
<li>step 1: prepare a folder as in the previous chapter</li>
<li>Step 2: compile the folder into a new folder (see below)</li>
<li>Step 3: pack the new folder into a jar for distribution</li>
</ul>
<p>Run in an empty IDE tab or as part of a script:</p>
<p><code>Sikulix.compileJythonFolder(sourcefolder, targetfolder)</code></p>
<p>copies the complete content from source folder to target folder (the parent folder must exist, the folder is emptied if exists) and then traverses the target folder replacing each <code>foobar.py</code> with it’s compiled version <code>foobar$py.class</code>, that contains JVM-byte-code, so your script code cannot be edited anymore in this target folder, but still be used with <code>import foobar</code>.</p>
<p><strong>Be aware:</strong> Be sure, your code compiles without errors, because the compile feature either succeeds or fails (compile errors), but you will not get any information about the cause or even the place of the compile problem.</p>
<h2 id="Scripting-with-IntelliJ-PyCharm-and-IDEA-with-Python-plugin"><a href="#Scripting-with-IntelliJ-PyCharm-and-IDEA-with-Python-plugin" class="headerlink" title="Scripting with IntelliJ PyCharm and IDEA with Python plugin"></a>Scripting with IntelliJ PyCharm and IDEA with Python plugin</h2><p>PyCharm has a weakness, in that code completion while editing does not look into jar-files nor Java classes, while in the built-in Python console after having imported a Java class, code completion about the class attributes/methods works, so having a console open while editing might help as a workaround for inspecting Java classes.</p>
<p><strong>Step 1: get Jython up and running</strong></p>
<p>Just follow the steps mentioned in the chapter <code>Setup a Jython environment</code> above.</p>
<p><strong>Step 2: get PyCharm up and running</strong></p>
<p>Download and install the <a href="https://www.jetbrains.com/pycharm/" target="_blank" rel="external">PyCharm Community Edition</a>.</p>
<p><strong>Step 3: tell PyCharm to use Jython as interpreter</strong></p>
<p>Start PyCharm and make sure to have closed all projects and be in the start-up window titled <code>Welcome to PyCharm</code>.</p>
<p>At bottom right in the menu <code>Configure</code> select <code>Preferences</code>. You should get a dialog window titled <code>Default Preferences</code>.</p>
<p>At the left side select <code>Project Interpreter</code> and choose your installed Jython by pointing to the contained <code>.../bin/jython</code> script/command-file.</p>
<p>Click <code>Apply</code> and watch how the Jython setup is analyzed and implemented in PyCharm. If it worked click <code>Ok</code>.</p>
<p> <img src="http://sikulix-2014.readthedocs.io/en/latest/_images/pycharmDefaultInterpreter.png" alt="1|center"></p>
<p><strong>Step 4: setup the environment for a Python console</strong></p>
<p>As with the step before get the <code>Default Preferences</code> dialog open.</p>
<p>At the left side select <code>Build, Execution, Deployment</code>… <code>Console</code>… <code>Python Console</code>.</p>
<p>To the <code>Environment variables</code> add entry <code>CLASSPATH</code>, that points to a valid <code>sikulixapi.jar</code> (created using setup).</p>
<p>In the <code>Starting script</code> you might add the 2 lines <code>import org.sikuli.script.SikulixForJython from sikuli import *</code> so each time you start a console, the prompt is already prepared to know about SikuliX features.</p>
<p> <img src="http://sikulix-2014.readthedocs.io/en/latest/_images/pycharmDefaultConsole.png" alt="2|center"></p>
<h1 id="Using-RobotFramework"><a href="#Using-RobotFramework" class="headerlink" title="Using RobotFramework"></a>Using RobotFramework</h1><p>You can run ready Robot scripts out of the box in the SikuliX context (IDE or from command line). The needed Python module robot ( from <a href="https://pypi.python.org/pypi/robotframework" target="_blank" rel="external">robotframework 3.0</a> ) is bundled with the <code>sikulixapi.jar</code>. At runtime and already with setup, the module is exported to the folder <code>&lt;SikulixAppData&gt;/Lib</code>, which is on <code>sys.path</code> automatically. So there is no need to have anything else available than a suitable setup of SikuliX.</p>
<p>The easiest way is to use the SikuliX IDE with this principal setup</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">runScript(<span class="string">"""</span></div><div class="line">robot</div><div class="line">*** Variables ***</div><div class="line">$&#123;USERNAME&#125;               demo</div><div class="line">$&#123;PASSWORD&#125;               mode</div><div class="line">$&#123;TESTSITE&#125;               http://test.sikuli.de</div><div class="line">*** Settings ***</div><div class="line">Library           ./inline/LoginLibrary</div><div class="line">Test Setup        start firefox and goto testsite    $&#123;TESTSITE&#125;</div><div class="line">Test Teardown     stop firefox</div><div class="line">*** Test Cases ***</div><div class="line">User can log in with correct user and password</div><div class="line">    Attempt to Login with Credentials    $&#123;USERNAME&#125;    $&#123;PASSWORD&#125;</div><div class="line">    Status Should Be    Accepted</div><div class="line">User cannot log in with invalid user or bad password</div><div class="line">    Attempt to Login with Credentials    betty    wrong</div><div class="line">    Status Should Be    Denied</div><div class="line">""")</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginLibrary</span><span class="params">(object)</span>:</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_firefox_and_goto_testsite</span><span class="params">(self, page)</span>:</span></div><div class="line">    popup(<span class="string">"start_firefox_and_goto_testsite"</span>)</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">stop_firefox</span><span class="params">(self)</span>:</span></div><div class="line">    popup(<span class="string">"stop_firefox"</span>)</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">attempt_to_login_with_credentials</span><span class="params">(self, username, password)</span>:</span></div><div class="line">    popup(<span class="string">"attempt_to_login_with_credentials"</span>)</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">status_should_be</span><span class="params">(self, expected)</span>:</span></div><div class="line">    popup(<span class="string">"status_should_be"</span>)</div></pre></td></tr></table></figure>
<p>the first 2 lines</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">runScript(<span class="string">"""</span></div><div class="line">robot</div></pre></td></tr></table></figure>
<p>signal, that you want to run an inline Robot script, that follows on the next lines terminated by <code>&quot;&quot;&quot;)</code>. This construct is a multiline Python comment, that can be used as a string.</p>
<p><strong>BE AWARE</strong> In the standard, a report HTML will be automatically opened in the standard browser at termination. If you do not want that (e.g. in unattended situations) use this instead as the first 2 lines. Take care: after robot 1 space, a linefeed directly after silent and nothing else.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">runScript(<span class="string">"""</span></div><div class="line">robot silent</div></pre></td></tr></table></figure>
<p>Normally when working with SikuliX features, you have to do some Robot Keyword implementation at the Python level. To Robot you tell where to find these implementation using the <code>Library setting</code>.</p>
<p>In this case we have the implementations inline in the same script file according to the Robot rules packed into a Python class having the Keyword methods according to the Robot naming conventions. At runtime this class will be exported to a Python file, whose absolute path is then replacing the Library setting.</p>
<p>If you have the Keyword implementations somewhere outside, then you have to put the correct path specification into the Library setting. Another option is to reference a jar file as a Library again according to the Robot specifications.</p>
<p>If you now run the script in the IDE, internally a <code>robot.run</code> will be fired after having setup the script content and the environment. Currently no extra options can be provided for the robot run. As a result you get a folder with the ending <code>.robot</code> named as your script in the same folder as your script folder containing inputs to and the results from the robot run</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># supposing the script is named testrobot.sikuli</span></div><div class="line"><span class="comment"># then you get a folder testrobot.sikuli.robot with the content</span></div><div class="line">testrobot.robot <span class="comment"># the robot script</span></div><div class="line">LoginLibrary.py <span class="comment"># the Python Keyword implementations</span></div><div class="line"><span class="comment"># the standard Robot outcome</span></div><div class="line">output.xml</div><div class="line">log.html</div><div class="line">report.html</div></pre></td></tr></table></figure>
<p>Still being in the IDE another possible setup would be this way:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">robotScript = <span class="string">"""</span></div><div class="line">robot</div><div class="line">*** Variables ***</div><div class="line">$&#123;USERNAME&#125;               demo</div><div class="line">$&#123;PASSWORD&#125;               mode</div><div class="line">$&#123;TESTSITE&#125;               http://test.sikuli.de</div><div class="line">*** Settings ***</div><div class="line">Library           /some/path/to/LoginLibrary.py</div><div class="line">Test Setup        start firefox and goto testsite    $&#123;TESTSITE&#125;</div><div class="line">Test Teardown     stop firefox</div><div class="line">*** Test Cases ***</div><div class="line">User can log in with correct user and password</div><div class="line">    Attempt to Login with Credentials    $&#123;USERNAME&#125;    $&#123;PASSWORD&#125;</div><div class="line">    Status Should Be    Accepted</div><div class="line">User cannot log in with invalid user or bad password</div><div class="line">    Attempt to Login with Credentials    betty    wrong</div><div class="line">    Status Should Be    Denied</div><div class="line">"""</div><div class="line"></div><div class="line"><span class="comment"># here you could do some preprocessing and even modify the above robotscript</span></div><div class="line"></div><div class="line">runScript(robotscript)</div><div class="line"></div><div class="line"><span class="comment"># eventually do something with the result</span></div></pre></td></tr></table></figure>
<p><strong>BE AWARE</strong> for the keyword library, the <code>Name</code> in the file name <code>Name.py</code> and the statement <code>class Name()</code> <strong>must</strong> be the same and start with an uppercase letter.</p>
<p><strong>BE AWARE ON WINDOWS</strong> the file path must be escaped with 4 backslashes for each backslash like so <code>C:\\\\Robot\\\\Libraries\\\\Name.py</code> (which leads to the needed 2 backslashes for each backslash as escape in the final robot file)</p>
<blockquote>
<p><strong>I think two backslashes are just enough.</strong></p>
</blockquote>
<p>Of course you can use any other method, to fill a string representing a valid Robot script, provided the first line contains the string <code>robot</code> and only that (denoting the script type for run Script).</p>
<p>If in such a case you want to provide an inline Keyword implementation: this does the trick:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># prepare your script content</span></div><div class="line">runScript(<span class="string">"robot\n"</span> + scriptContent)</div><div class="line"><span class="comment"># eventually do something with the result</span></div><div class="line"></div><div class="line"><span class="comment"># """)</span></div><div class="line"></div><div class="line"><span class="comment"># the rest is taken as inline Keyword implementation</span></div></pre></td></tr></table></figure>
<p>If you have the need to specify extra parameters to the <code>robot.run()</code>, then you still have the option to stay within the SikuliX context (IDE or from command line):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">prepareRobot() <span class="comment"># takes care for the correct environment</span></div><div class="line"></div><div class="line">workdir = getParentFolder()</div><div class="line">script = <span class="string">"arobottest/arobottest.robot"</span></div><div class="line">robotscript = os.path.join(workdir, script)</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">"*** trying to run:"</span>, robotscript</div><div class="line">robot.run(robotscript, outputdir=workdir)</div></pre></td></tr></table></figure>
<p>A <code>library.py</code> file being either in the script folder itself or in the folder containing the script folder is found automatically. So simply the library name is enough in this case. In all other cases you either have to specify the absolute path off the <code>.py</code> script (take care with windows - see above) or use <code>addImportPath()</code> to add the folder containing the <code>library.py</code> file to <code>sys.path</code>, in which case again only the name is sufficient in the Robot script.</p>
<p>It is strongly recommended, to always specify the <code>outputdir= parameter</code> since otherwise the report files will be written to the working folder (from where you are running), which might not always be what you want.</p>
<p>If you want to use any of these variants outside the SikuliX context (some external Jython or in an IDE like PyCharm) you have to add these 2 lines at the beginning of your main script (as always in such cases):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.sikuli.script.SikulixForJython</div><div class="line"><span class="keyword">from</span> sikuli <span class="keyword">import</span> *</div></pre></td></tr></table></figure>
<p>to get the SikuliX context ready.</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>Post author:</strong>
      Jingwen CHEN
    </li>
    <li class="post-copyright-link">
      <strong>Post link:</strong>
      <a href="http://fatelancer.github.io/2018/06/21/SikuliX/" title="SikuliX">http://fatelancer.github.io/2018/06/21/SikuliX/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Copyright Notice: </strong>
      All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/jython/" rel="tag"># jython</a>
          
            <a href="/tags/python/" rel="tag"># python</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/04/EESM-5650-L1-Introduction/" rel="next" title="EESM 5650 L1 Introduction">
                <i class="fa fa-chevron-left"></i> EESM 5650 L1 Introduction
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/06/21/LabVIEW-基础教程（一）/" rel="prev" title="">
                 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Jingwen CHEN" />
          <p class="site-author-name" itemprop="name">Jingwen CHEN</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/fatelancer" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://diligentpanda.github.io" target="_blank" title="Jianghe">
                  
                    <i class="fa fa-fw fa-address-book-o"></i>
                  
                  Jianghe
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Sikuli-Script"><span class="nav-number">1.</span> <span class="nav-text">Sikuli Script</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#general-aspect-of-scripting"><span class="nav-number">1.1.</span> <span class="nav-text">general aspect of scripting</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Where-and-how-can-a-SikuliX-script-be-stored"><span class="nav-number">1.2.</span> <span class="nav-text">Where and how can a SikuliX script be stored</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-Run-a-SikuliX-script"><span class="nav-number">1.3.</span> <span class="nav-text">How to Run a SikuliX script</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-Python"><span class="nav-number">2.</span> <span class="nav-text">Using Python</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Setup-a-Jython-environment"><span class="nav-number">2.1.</span> <span class="nav-text">Setup a Jython environment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Access-Python-packages-from-SikuliX-scripts-run-by-SikuliX-GUI-or-command-line"><span class="nav-number">2.2.</span> <span class="nav-text">Access Python packages from SikuliX scripts run by SikuliX (GUI or command line)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Basic-preparation"><span class="nav-number">2.2.1.</span> <span class="nav-text">Basic preparation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Approach-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">Approach 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Approach-2"><span class="nav-number">2.2.3.</span> <span class="nav-text">Approach 2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prepare-and-use-your-own-jar-files-in-the-Jython-environment"><span class="nav-number">2.3.</span> <span class="nav-text">Prepare and use your own jar files in the Jython environment</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#possible-use-case"><span class="nav-number">2.3.1.</span> <span class="nav-text">possible use case</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#typical-jar-file-structure"><span class="nav-number">2.3.2.</span> <span class="nav-text">typical jar file structure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-to-pack-such-a-jar"><span class="nav-number">2.3.3.</span> <span class="nav-text">how to pack such a jar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-to-secure-your-script-code-using-the-jar-packaging"><span class="nav-number">2.3.4.</span> <span class="nav-text">how to secure your script code using the jar packaging</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scripting-with-IntelliJ-PyCharm-and-IDEA-with-Python-plugin"><span class="nav-number">2.4.</span> <span class="nav-text">Scripting with IntelliJ PyCharm and IDEA with Python plugin</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-RobotFramework"><span class="nav-number">3.</span> <span class="nav-text">Using RobotFramework</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jingwen CHEN</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "38b19d1652f64af7889cf1d358fbfb1b",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

</body>
</html>
